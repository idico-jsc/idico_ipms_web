# Project Architecture

Feature-based architecture with Atomic Design, i18n, PWA, and Capacitor mobile support.

## Folder Structure

```
src/
├── app/                 # Next.js-style App Router
│   ├── layout.tsx      # Root layout (wraps all routes)
│   ├── page.tsx        # Home page (/)
│   ├── routes.tsx      # Router system (auto-generated)
│   ├── not-found.tsx   # 404 page (catch-all)
│   ├── error.tsx       # Root error boundary
│   ├── about/
│   │   └── page.tsx    # /about
│   ├── contact/
│   │   └── page.tsx    # /contact
│   └── (auth)/         # Route group (not in URL)
│       ├── layout.tsx  # Auth layout
│       └── login/
│           └── page.tsx # /login
│
├── components/          # Atomic Design Components
│   ├── atoms/          # Basic UI elements (Button, Input, etc.)
│   ├── molecules/      # Simple component combinations
│   ├── organisms/      # Complex UI components
│   ├── templates/      # Page-level layouts
│   ├── pages/          # Page-specific components
│   └── index.ts       # Public exports
│
├── features/           # Feature Modules (Business Logic)
│   ├── auth/          # Authentication feature
│   ├── dashboard/     # Dashboard feature
│   └── profile/       # Profile feature
│
├── hooks/             # Shared custom hooks
│   ├── use-capacitor.ts    # Capacitor/mobile hooks
│   ├── use-dark-mode.ts    # Dark mode toggle
│   ├── use-language.ts     # i18n language switching
│
├── utils/             # Utility functions
│   ├── capacitor.ts   # Capacitor platform utilities
│   ├── cn.ts          # Tailwind class merger
│   └── index.ts      # Public exports
│
├── providers/         # React Context Providers
│   ├── theme-provider.tsx  # Dark mode provider
│   └── i18n-provider.tsx   # i18n provider
│
├── locales/          # Internationalization
│   ├── en/
│   │   ├── common.json
│   │   └── home.json
│   └── vi/
│       ├── common.json
│       └── home.json
│
├── lib/              # Third-party library configurations
│   ├── i18n.ts       # i18next configuration
│   └── utils.ts      # Shared utilities
│
├── constants/        # Global constants
│   ├── languages.ts  # Supported languages
│   ├── version.ts    # App version
│   └── index.ts     # Public exports
│
├── types/            # Global TypeScript types
│   ├── i18n.d.ts     # i18next type definitions
│   └── index.ts     # Public exports
│
├── store/            # Global state management
│   └── index.ts     # State exports
│
├── data/             # Static data and mock data
│   └── index.ts     # Public exports
│
└── main.tsx          # Application entry point
```

## Native Platform Structure

```
build/
├── android/              # Android project (gitignored, generated by Capacitor)
│   └── app/src/main/assets/public/  # Web build synced here
└── ios/                  # iOS project (gitignored, generated by Capacitor)
    └── App/App/public/   # Web build synced here
```

## Key Configuration Files

- `capacitor.config.ts` - Capacitor & native app config
- `vite.config.ts` - Build config (base: './' for mobile)
- `tsconfig.json` - TypeScript paths (@/*)
- `package.json` - Dependencies & scripts

## Architecture Principles

### 1. Atomic Design (Components)

Components are organized by complexity:

- **Atoms**: Basic building blocks (Button, Input, Label)
- **Molecules**: Simple combinations (SearchBox, FormField)
- **Organisms**: Complex components (Navbar, Card, Modal)
- **Templates**: Page layouts (DashboardLayout, AuthLayout)
- **Pages**: Page-specific components that don't fit routing

### 2. Feature-Based Structure

Each feature is self-contained with:

```
feature-name/
├── components/     # Feature-specific UI components
├── hooks/         # Feature-specific hooks
├── services/      # API calls and business logic
├── types/         # TypeScript types
├── utils/         # Helper functions
└── index.ts      # Public API
```

### 3. Next.js-Style App Router

**File Conventions**:
- `page.tsx` - Route endpoint (app/about/page.tsx → `/about`)
- `layout.tsx` - Shared wrapper (cascades automatically)
- `error.tsx` - Error boundary
- `not-found.tsx` - 404 fallback
- `(folder)` - Route group (not in URL: (auth)/login → `/login`)
- `_folder` - Private folder (excluded from routing)

**Benefits**: File-system = URL, no manual registration, auto-discovery

### 4. Mobile-First (Capacitor)

**Utilities**: `@/utils/capacitor` - isNative, isIOS, isAndroid, isWeb

**Hooks**: usePlatform(), useAppState(), useBackButton(), useAppInfo()

### 5. i18n

**Languages**: en, vi | **Structure**: `locales/{lang}/{namespace}.json`

**Usage**: `useTranslation('namespace')` → `t('key')`

### 6. PWA

Service Worker, offline support, install prompt, push notifications ready

### 7. Dark Mode

`useTheme()` hook + ThemeProvider + Tailwind dark classes

### 8. Import Rules

✅ Pages → Features → Components → Utils/Hooks

❌ No cross-feature imports, no circular dependencies

### 9. Build Commands

```bash
npm run dev                # Dev server
npm run build              # Web build → build/web/
npm run build:apk:debug    # Android APK
npm run cap:sync           # Sync web to native
npm run cap:run:android    # Run on Android
```

## Quick Examples

```tsx
// Import components
import { Button } from '@/components/atoms/button';
import { useAuth } from '@/features/auth';

// Platform detection
const { isNative, isAndroid } = usePlatform();

// i18n
const { t } = useTranslation('home');

// Dark mode
const { isDark, toggleDarkMode } = useTheme();

// Create new page: app/about/page.tsx
export default function AboutPage() {
  return <div>{t('about.title')}</div>;
}
// Route auto-discovered: /about
```

## Naming Conventions

- **Components**: PascalCase.tsx
- **Hooks**: use-hook-name.ts
- **Utils**: kebab-case.ts
- **Pages/Layouts**: page.tsx, layout.tsx

**Path Alias**: `@/*` → `./src/*`

## Best Practices

1. Keep features independent, use atomic components, use `@/` imports
2. **Mobile**: Check platform before native features, test on real devices
3. **i18n**: Namespace translations, never hardcode strings
4. **Performance**: Lazy load routes, optimize images, PWA caching

## State Management

- **Local**: useState, useContext (theme, i18n)
- **Global**: Zustand (auth state, NOT persisted)
- **Server**: SWR (data fetching, caching, revalidation)
- **Auth**: See [AUTH_GUIDE.md](AUTH_GUIDE.md)

## API Integration

### Frappe Backend

**Setup**: FrappeProvider wraps app, bearer token auth, Zustand + SWR

**Hooks**: Import from `frappe-react-sdk`
```tsx
import { useFrappeGetDoc, useFrappeGetDocList, useFrappeCreateDoc } from 'frappe-react-sdk';

// Use directly
const { data } = useFrappeGetDoc('User', 'john@example.com');
```

**Complete docs**: [AUTH_GUIDE.md](AUTH_GUIDE.md), [FRAPPE_INTEGRATION.md](FRAPPE_INTEGRATION.md)

### Other APIs

Use SWR in `feature/services/queries.ts` + API calls in `feature/services/api.ts`

## Testing, Security & Performance

**Testing**: Cypress (E2E), Vitest (unit), real device testing

**Security**: .env files (not committed), HTTPS only, minimal permissions

**Performance**: Vite optimization, lazy loading, image optimization, PWA caching

## Build Outputs

- **Web**: `build/web/` (~500 KB, deploy to Netlify/Vercel)
- **Android APK**: `build/android/app/build/outputs/apk/debug/` (~4-5 MB)
- **Android AAB**: `build/android/app/build/outputs/bundle/release/` (Play Store)
- **iOS**: `build/ios/` (macOS only)

## Related Documentation

- [ROUTING_GUIDE.md](./ROUTING_GUIDE.md) - **File-based routing guide** (Next.js-style)
- [CAPACITOR_IMPLEMENTATION_GUIDE.md](./CAPACITOR_IMPLEMENTATION_GUIDE.md) - Setup Capacitor
- [CAPACITOR_GUIDE.md](./CAPACITOR_GUIDE.md) - Use Capacitor features
- [BUILD_ANDROID_APK.md](./BUILD_ANDROID_APK.md) - Build Android apps
- [MOBILE_DEVELOPMENT.md](./MOBILE_DEVELOPMENT.md) - Mobile workflow
- [I18N_GUIDE.md](./I18N_GUIDE.md) - Internationalization
- [CREATE_PAGE.md](./CREATE_PAGE.md) - Create new pages
- [PWA_SETUP.md](./PWA_SETUP.md) - PWA features
- [FRAPPE_INTEGRATION.md](./FRAPPE_INTEGRATION.md) - Frappe backend integration

---

**Architecture Version**: 2.0
**Last Updated**: 2025-10-17
**Tech Stack**: React 19 + TypeScript 5 + Vite 7 + Capacitor 7 + Tailwind 4
